{
  "hash": "04ab3b70b28e021d6ec5ba7a95afafeb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aligning with EIA's metrics\"\ndate: \"today\"\ncategories: [code, energy, eaglei]\nexecute: \n  eval: false\n---\n\n\n\n\n## Assembling the tools\n\nThis post is the second in a series exploring the DOE's [Eagle-I dataset](https://openenergyhub.ornl.gov/explore/dataset/eaglei_outages_2014/information/){target=\"_blank\"} on energy grid outages. See previous posts here: [first](../intro/index.html){target=\"_blank\"}\n\nHowever, before going further, it's worth digressing to pause and discuss differences in the data available from Eagle-I and that the Energy Information Administration (EIA) uses to visualize people's experiences with power outages, in this [article](https://www.eia.gov/todayinenergy/detail.php?id=54639){target=\"_blank\"}. \n\nThe main EIA metrics of interest are the System Average Interruption Duration Index (SAIDI) & System Average Interruption Frequency Index (SAIFI). In the article's second figure (copied below), SAIDI and SAIFI show up on the horizontal and vertical axes, respectively.\n\n::: column-margin\nFor a quick-hit understanding, check the [EIA's video guide](https://youtu.be/oVH9L0fCMTU){target=\"_blank\"}\n:::\n\n![](../intro/chart2.svg){fig-alt=\"Average total annual electric power interruption duration and frequency per customer, by state, for 2021 only\"}\n\nAll ths background to say that SAIDI divides the number of customers affected by an outage by the number of customers in the system. **We do not have the latter available to us in Eagle-I**, so for the sake of this exercise, I will pull in county-level population data from the `tidycensus` [package](https://walker-data.com/tidycensus/){target=\"_blank\"}, and see how closely we can replicate the EIA's published values.\n\n::: column-margin\nAs always, there are important assumptions embedded in our assumptions. Here, we're assuming everyone in every county in the US is connected to the grid, or \"in the system\", to use the EIA's language. Not sure I like the sound of \"in the system\", but alas, we're stuck with the term.\n:::\n\n## Calculating SAIDI\n\nHere's an example of a function that takes our 15min-interval Eagle-I data and calculates a SAIDI metric. It's a single `mutate` call but we can give it a meaningful name so it's easier to understand what the targets pipeline is doing.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalc_saidi <- function(eaglei_df,\n                       # Time intervals are 15min per documentation, or 0.25h\n                       data_interval = as.numeric(15, units = \"minutes\")) {\n  eaglei_df %>%\n    # This step assumes that all county residents are on the grid. Neither the\n    # outage data nor the population data is split by utility territory\n    mutate(saidi = customers_out * data_interval / county_pop)\n}\n```\n:::\n\n\n\n\nSee the screengrab below for sample output from this function: ![](./sample_saidi_min.png){fig-alt=\"Console output in R showing five rows with the calculated SAIDI metric\"}.\n\nIn `_targets.R`, we call the function in its own target, using the feature-enhanced Eagle-I dataset in the preceding target.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist(\n  # Targets before...,\n  tar_target(\n    name = add_features,\n    command = add_outage_id(states_eaglei) %>% \n      join_eaglei_census(states_census)\n  ),\n  tar_target(\n    name = saidi_calcs_by_min,\n    command = calc_saidi(add_features)\n  ),\n  tar_target(\n    name = county_outage_saidi,\n    command = saidi_calcs_by_min %>% \n      ## Create a summary row for each outage in each state/county\n      summarise(saidi = sum(saidi),\n                outage_interval = {\n                  max(run_start_time) - min(run_start_time)\n                } %>% \n                  as.difftime() %>% \n                  as.numeric(units = \"hours\"),\n                .by = c(state, county, outage_id))\n  )\n  # Targets after...\n)\n```\n:::\n\n\n\n\nThe SAIFI of an event is the fraction of customers affected, i.e. taking the SAIDI and dividing out the duration term. This calculation would look similar to the SAIDI mutate call, but we'd calculate it on a per-event basis.\n\nThis screengrab, showing output from the last target listed, confirms we should have all the building blocks necessary to calculate the SAIFI of each outage. ![](sample_saidi.png){fig-alt=\"Console output in R showing five rows with one row per outage, showing the SAIDI and total outage duration (in hours) for each\"}\n\nI will continue to document my work via blog post, but you can follow commits to the underlying [repo](https://github.com/jdnricardo/eaglei_outages) as well!\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}