{
  "hash": "881b05f96ee9faa73ea66ea0c4e91f55",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing outage data\"\ndate: \"2024-10-23\"\ncategories: [code, energy, eaglei]\nformat:\n  html:\n    code-fold: true\nexecute: \n  eval: false\n---\n\n\n\n## Assembling the tools\n\nThis post is the third in a series exploring the DOE's [Eagle-I dataset](https://openenergyhub.ornl.gov/explore/dataset/eaglei_outages_2014/information/){target=\"_blank\"} on US electrical grid outages. See previous posts here: [I](../intro/index.html){target=\"_blank\"} and [II](../eia_metrics/index.html){target=\"_blank\"}\n\nI gave away in my previous post that I had drafted numbers to compare with the EIA for a few states.\n\n![](../eia_metrics/sample_saidi_state.png){fig-alt=\"Console output in R showing the calculated SAIDI metric for an assortment of US states\"}.\n\n They did not match the EIA chart (see below), but were reasonable enough for me to justify making more-polished visualizations. In more words, \"reasonable\" given just the uncertainties in data sourcing I already know about, let alone the Rumsfeldian unknowns lurking about. Before testing my ~~hubris~~ hypothesis that I've replicated anything worth posting about...\n\nA few caveats:\n\n- I am comparing numbers with the set from the EIA that *includes major events*, to avoid coming up with independent estimates of when these events occurred in the Eagle-I data, merging that data in somehow, etc.\n- I am comparing numbers with numbers I am reading off of the EIA chart, rather than coming up with my own aggregated state numbers from their underlying utility-level spreadsheet. That is an exercise for another day\n- I did not run the Eagle-I analysis on all 50 states, ~~because I'm impatient~~ to save computation time. I ran only the 8 states labeled in the EIA chart: Kentucky, Louisiana, Maine, Michigan, Mississippi, Oregon, Texas, West Virginia.\n\nLast bit before jumping into the charts... my setup chunk, where I load packages, set my `ggplot2` theme, and assemble the necessary targets (i.e. datasets I produced in my pipeline). For colors, I'm using reds from [Reasonable Colors](https://www.reasonable.work/colors/red/) today.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\nlibrary(tidytable)\nlibrary(forcats)\nlibrary(ggplot2)\nlibrary(ggtext)\nlibrary(ggrepel)\nlibrary(scales)\n\ntheme_set(theme_minimal(base_size = 18) +\n            theme(panel.grid = element_blank(),\n                  plot.background = element_rect(fill = \"#fcfcfc\")))\n\ntar_load(matches(\"sai[df]i\"), store = \"../_targets\")\n\nmedian_tag <- \"<span style = 'color:#530003;'><strong>US median*</strong></span>\"\nmedian_red <- \"#530003\"\nbase_red <- \"#FF4647\"\n```\n:::\n\n\n\n## Spoiler alert\n\nI managed to create a chart that looks like what I was after! Recall the chart we started with, from this EIA [article](https://www.eia.gov/todayinenergy/detail.php?id=54639){target=\"_blank\"}. The two metrics I'm interested in replicating from the chart are System Average Interruption Duration Index (SAIDI, horiz. axis) and System Average Interruption Frequency Index (SAIFI, vert. axis).\n\n![](../intro/chart2.svg){fig-alt=\"Average total annual electric power interruption duration and frequency per customer, by state, for 2021 only\"}\n\nWhat's below is only a draft, for reasons I'll get into with the remainder of this post.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninner_join(\n  state_saidi,\n  state_saifi,\n  by = \"state\"\n) %>% \n  bind_rows(\n    data.frame(\n      state = \"US median*\",\n      # Technically, they say \"just over seven hours\" so I added 5% to SAIDI.\n      # SAIFI is interpreted from graph\n      saidi = 7*1.05,\n      saifi = 1.4\n    )\n  ) %>% \n  mutate(\n    state = fct_reorder(state, saidi)\n  ) %>% \n  ggplot(aes(x = saidi,\n             y = saifi)) +\n  geom_point(aes(color = state == \"US median*\"),\n             size = rel(4),\n             alpha = 1/1.5) +\n  geom_text_repel(aes(color = state == \"US median*\",\n                      label = state)) +\n  scale_color_manual(values = c(base_red,\n                                median_red)) +\n  expand_limits(x = 0,\n                y = 0) +\n  labs(title = paste(\"States' SAIDIs & SAIFIs compared to the\", median_tag), \n       caption = \"*including major events\") +\n  guides(color = \"none\") +\n  theme(panel.grid.major = element_line(\"grey90\"),\n        axis.title = element_blank(),\n        title = element_markdown(size = rel(0.8)))\n```\n:::\n\n\n\n![](./images/scatter-1.png){fig-alt=\"Scatterplot comparing my estimates of SAIDI and SAIFI for each of 8 states, alongside EIA median values.\"}\n\n## Total annual outages\n\nI will start off comparing my SAIDI with the EIA's median value of \"just over seven hours\", translated by yours truly to 7.35 (or 5% higher). Louisiana catches the eye, being so far out at 50+ hours. But that's not as far adrift as it is in the EIA data, at 80+ hours. Maine has the lowest SAIDI in my analysis and the EIA's (you go Maine!). Most states in my analysis are above the EIA median, as I expected. But on closer inspection, it's by smaller margins than I want to see before closing out this analysis. Kentucky is above-median according to the EIA and below-median if you look at my analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_saidi %>% \n  bind_rows(\n    data.frame(\n      state = median_tag,\n      # Technically, they say \"just over seven hours\"\n      # so I added 5%\n      saidi = 7*1.05\n    )\n  ) %>% \n  mutate(\n    state = fct_reorder(state, saidi)\n  ) %>% \n  ggplot(aes(x = saidi,\n             y = state)) +\n  geom_col(aes(fill = state == median_tag)) +\n  scale_fill_manual(values = c(base_red,\n                               median_red)) +\n  labs(caption = \"*including major events\") +\n  guides(fill = \"none\") +\n  theme(panel.grid.major.x = element_line(\"grey90\"),\n        axis.text.y = element_markdown(),\n        axis.title = element_blank())\n```\n:::\n\n\n\n![](./images/state_saidi-1.png){fig-alt=\"Bar chart showing state SAIDI values as calculated from Eagle-I data, compared to the EIA median value.\"}\n\nI will need to take another look at my approach to calculating SAIDI, and have a sneaking suspicion I need to handle missing chunks of the time-series better.\n\nI should also check how the distribution of SAIDIs in individual counties held up, to better understand how I'm calculating right-tail outcomes especially. Right on time, a wild violin chart appears! The lines in each violin indicate the median SAIDI among a state's counties, as well as the 5th / 95th SAIDI percentiles.\n\n::: column-margin\nShoutout to the `ggtext` package for making it easy to experiment with color-tagging my title!\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_saidi %>% \n  mutate(\n    state = fct_reorder(state, saidi)\n  ) %>% \n  ggplot(aes(x = saidi,\n             y = state)) +\n  geom_violin(draw_quantiles = c(0.05, 0.5, 0.95),\n              fill = base_red) +\n  geom_vline(xintercept = 7*1.05,\n             color = median_red,\n             linewidth = rel(1.1)) +\n  scale_x_sqrt() +\n  labs(title = paste(\"States' county SAIDIs compared to the\", median_tag), \n       caption = \"*including major events\") +\n  guides(fill = \"none\") +\n  theme(panel.grid.major.x = element_line(\"grey90\"),\n        axis.title = element_blank(),\n        title = element_markdown(size = rel(0.8)))\n```\n:::\n\n\n\n![](./images/county_saidi-1.png){fig-alt=\"Bar chart showing county SAIDI values as calculated from Eagle-I data, compared to the EIA median value.\"}\nThis helps my self-esteem a little bit. Maybe I have moderately, but not egregiously, underestimated the largest and/or longest outages? Still, look out for revisions to the SAIDI calculations in a future post!\n\n## Number of outages\n\nShowing the same charts, but now with SAIFI rather than SAIDI. Other than Louisiana coming in **above** the EIA estimate, I can summarize everything else as worse than my SAIDI analysis in replicating the EIA estimates. The SAIFI values I came up with are lower than the EIA's state-level estimates. Most notable are the many state SAIFI estimates that come in lower than the EIA median... a clearer sign that more work is needed here.\n\n![](./images/state_saifi-1.png){fig-alt=\"Bar chart showing state SAIFI values as calculated from Eagle-I data, compared to the EIA median value.\"}\n\n![](./images/county_saifi-1.png){fig-alt=\"Bar chart showing county SAIFI values as calculated from Eagle-I data, compared to the EIA median value.\"}\n\n## Next steps\n\nSetting aside whether or how much I can mitigate uncertainty due to using census population figures (and not utility customer figures), I feel confident there is room to tighten up my SAIDI and SAIFI calculations with a closer review of them. Along the way, I plan to develop additional charts to quantify the discrepancies I find.\n\nIdeally, I would also show the above charts alongside the *actual* EIA values for each state / county, and not just the overall median value as derived from visually interpreting their published chart. It's not exactly a sturdy foundation for comparative analysis...\n\nFirming this up will require reading in & manipulating data the EIA publishes on utility reliability (in spreadsheets named \"Reliability.xlsx\" for each calendar year). From a quick glance, the reliability files allow for taking a weighted average SAIDI / SAIFI for each state, using the \"Number of Customers\" column as the weight. Stay tuned for this update as well!\n\nTo cap things off, I would like to conjure up interactive visualizations of my Eagle-I analysis (and comparisons to the EIA figures), maybe with the `ggiraph` package.\n\n<!-- ## Visual narrative for EIA comp-->\n\n<!-- To start with, what does my version of the EIA scatterplot look like. Show this and my tabulated set of EIA values in faceted scatterplots -->\n\n<!-- Next, a dumbbell plot where one axis contains states, and the other compares points indicating my SAIDI / SAIFI and the EIA ones. -->\n\n<!-- Finally, a lolli / bar plot where the values are discrepancies between my metrics and the EIA's, using the latter as ground truth. -->\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}